<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판 로그인 페이지</title>
<meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.css">
<script type="text/javascript" src="js/jquery-1.12.4.min.js"/></script>
<script type="text/javascript">
	var REST_SERVICE_URI = 'http://192.168.0.29:8082/UML01Board/rest';

	$(document).on('pagecreate', function(){
		$('#btnLogin').unbind('click');
		$('#btnLogin').click(function(e){
			// 기본 이벤트 동작하지 않도록 하기
			e.preventDefault();

			// form 가져오기
			var form = $('#frmLogin')[0];

			// FormData 객체 생성
			var formData = new FormData(form);

			// 두 번 실행 방지를 위해 버튼 비활성
			$('#btnLogin').prop('disable',true);
			
				$.ajax({					
					type: 'post',
					url: REST_SERVICE_URI + '/user/login',
					data: formData,
					processData: false,
					contentType: false,
					cache: false,
					success: function(data, textStatus, xhr){
											
						$('#btnLogin').prop('disable',false);
							
							var location = xhr.getResponseHeader('Location');
							
							sessionStorage.setItem("base64Credentials", data);
							sessionStorage.setItem('location',location);
							$.mobile.changePage('home.html');
							
						},
						error: function(error) {
							$('#btnLogin').prop('disable',false);
							alert(error);
						}
					});					
			});
		$('#btnJoinSubmit').unbind('click');
		$('#btnJoinSubmit').click(function(e){
			// 기본 이벤트 동작하지 않도록 하기
			e.preventDefault();

			// form 가져오기
			var form = $('#frmJoin')[0];

			// FormData 객체 생성
			var formData = new FormData(form);

			// 두 번 실행 방지를 위해 버튼 비활성
			$('#btnJoinSubmit').prop('disable',true);
			
				$.ajax({					
					type: 'post',
					url: REST_SERVICE_URI + '/user',
					//enctype: 'multipart/form-data',					
					data: formData,
					enctype: 'multipart/form-data',
					processData: false,
					contentType: false,					
					cache: false,
					timeout: 60000,
					success: function(data, textStatus, xhr){
						$('#btnJoinSubmit').prop('disable',false);
							$.mobile.changePage('index.html');
						},
						error: function(error) {
							$('#btnLogin').prop('disable',false);
							alert(error);
						}
					});					
			});
	});

	$(document).on('pagechange', function(){
			var href = $(location).attr('href');
			var index = currentUrl.lastIndexOf('/');
			var currentUrl = href.substring(index);

			if(currentUrl.startsWith('/home.html')){
				$.ajax(){
					type:'get',
					url: sessionStorage.getItem('location'),
					authorization: sessionStorage.getItem('base64Credentials');
					contentType: 'application/json',
					dataType: 'json';
					success:function(data, textStatus, xhr){
						console.log(JSON.stringify(data));
						$('#email').html();
						$('#name').html();
						$('#authority').html();
						$('#avatar').attr('src',);
					},
					error:function(error){
							alert(error);	
					}						
				}									
			}
		});
</script>
<script type="text/javascript" src="js/jquery.mobile-1.4.5.js"></script>
</head>
<body>
	<div data-role="page">
		<div data-role="header">
			<h1>게시판 로그인</h1>
		</div>
		<div data-role="content">
			<form method="post" id="frmLogin">
				<div data-role="fieldcontain">
					<label for="email">이메일</label>
					<input type="email" name="email" id="email">
				</div>
				<div data-role="fieldcontain">
					<label for="password">비밀번호</label>
					<input type="password" name="password" id="password">
				</div>			
				<div class="ui-grid-a">
					<div class="ui-block-a">
						<a href="join.html" data-role="button" id="btnJoin">회원가입</a>
					</div>
					<div class="ui-block-b">
						<a href="#" data-role="button" id="btnLogin">로그인</a>
					</div>
				</div>
			</form>
			
		</div>
	</div>
</body>
</html>